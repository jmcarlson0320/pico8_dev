pico-8 cartridge // http://www.pico-8.com
version 41
__lua__
function _init()
 t=0
 dt=1/30
 particles={}
 bullets={}
 ship=make_ship()
end

function _update()
 t+=1
 update_ship()
 foreach(bullets,update_bullet)
 foreach(particles,update_particle)
 if btnp(⬆️) then sparkle_trail(64,64) end
end

function _draw()
 cls()
 draw_ship()
 foreach(bullets,draw_bullet)
 foreach(particles,draw_particle)
end

function make_ship()
 local s={}
 s.x=60
 s.y=112
 s.dx=0
 s.thrust=1000
 s.decel=200
 s.maxspd=75
 s.sprite=34
 return s
end

function update_ship()
 --- apply thrust
 if btn(0) then
  ship.sprite=33
  ship.dx-=ship.thrust*dt
 end
 if btn(1) then
  ship.sprite=35
  ship.dx+=ship.thrust*dt
 end

 -- limit max speed
 ship.dx=mid(-ship.maxspd,ship.dx,ship.maxspd)
 
 -- decellerate when not turning
 if not btn(0) and not btn(1) then
  ship.sprite=34
  if ship.dx<-10 then
   ship.dx+=ship.decel*dt
  elseif ship.dx>10 then
   ship.dx-=ship.decel*dt
  else
   ship.dx=0
  end
 end
  
 -- change position
 ship.x+=ship.dx*dt
 
 -- clamp to screen
 ship.x=mid(0,ship.x,120)
 
 -- fire bullet
 if btnp(4) or btnp(5) then
  make_bullet(ship.x+1,ship.y)
  make_bullet(ship.x+6,ship.y)
 end
end

function draw_ship()
 spr(ship.sprite,ship.x,ship.y)
end

function make_bullet(x,y)
 local b={}
 b.x=x
 b.y=y
 b.dy=-100
 add(bullets,b)
end

function update_bullet(b)
 b.y+=b.dy*dt
 if b.y<0 then del(bullets,b) end
 sparkle_trail(b.x,b.y)
end

function draw_bullet(b)
 circfill(b.x,b.y,1,8)
end

function add_particle(
 x,y,spread,
 dx,dy,
 life_min,life_max,
 colors
)
 local p={}
 p.x=x+rnd(2*spread)-spread
 p.y=y+rnd(2*spread)-spread
 p.dx=dx
 p.dy=dy
 p.lifetime=life_min+rnd(life_max-life_min)
 p.age=0
 p.col_tbl=colors
 add(particles,p)
end

function update_particle(p)
 if p.age>p.lifetime then
  del(particles,p)
 else
  p.age+=1
  p.x+=p.dx
  p.y+=p.dy
 end
end

function draw_particle(p)
 local num_col=#p.col_tbl
 local i=flr(p.age/p.lifetime*num_col)+1
 pset(p.x,p.y,p.col_tbl[i])
end

function sparkle_trail(x,y)
  add_particle(
   x,y,2,
   rnd(0.3),0,
   5,35,
   {8,2,1,5,7,13,5,5,1}
  )
end
__gfx__
00000000200080000800008000080002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000200080000800008000080002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700200028008200002800820002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000207c28008207c02800827c02000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000228228008288882800822822000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700202288008802208800882202000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000200080000800008000080002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000005000d0000d0000d0000d0005000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000003000b0000b0000b0000b0003000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000003000b0000b0000b0000b0003000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000030003b00b300003b00b30003000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000307c3b00b307c03b00b37c03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000033b33b00b3bbbb3b00b33b33000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000003033bb00bb0330bb00bb3303000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000003000b0000b0000b0000b0003000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000005000d0000d0000d0000d0005000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000009000a0000a0000a0000a0009000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000009000a0000a0000a0000a0009000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000090009a00a900009a00a90009000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000907c9a00a907c09a00a97c09000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000099a99a00a9aaaa9a00a99a99000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000009099aa00aa0990aa00aa9909000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000009000a0000a0000a0000a0009000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000005000d0000d0000d0000d0005000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000d000c0000c0000c0000c000d000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000d000c0000c0000c0000c000d000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000d000dc00cd0000dc00cd000d000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000d07cdc00cd07c0dc00cd7c0d000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000ddcddc00cdccccdc00cddcdd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000d0ddcc00cc0dd0cc00ccdd0d000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000d000c0000c0000c0000c000d000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000005000d0000d0000d0000d0005000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
